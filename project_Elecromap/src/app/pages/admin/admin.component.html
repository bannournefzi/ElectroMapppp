<!-- Top Navbar -->
<header class="navbar">
  <div class="navbar-left">
    <button class="menu-toggle" (click)="toggleSidebar()" [class.active]="sidebarCollapsed">
      <i class="fas fa-bars"></i>
    </button>
    <div class="logo">
      <i class="fas fa-bolt logo-icon"></i>
      <div class="logo-text">
        <span class="brand-name">ElectroMap</span>
        <span class="slogan">Find. Charge. Go</span>
      </div>
    </div>
  </div>
  
  <div class="navbar-center">
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input 
        type="text" 
        class="search-input" 
        placeholder="Rechercher une borne ou un utilisateur…"
        [(ngModel)]="searchQuery"
        (input)="onSearch($event)"
      >
    </div>
  </div>
  
  <div class="navbar-right">
    <div class="theme-toggle" (click)="toggleTheme()">
      <i [class]="darkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
    </div>
    
    <div class="notification-container" (click)="toggleNotifications()">
      <i class="fas fa-bell notification-icon" [class.active]="showNotifications"></i>
      <span class="notification-badge" *ngIf="notificationCount > 0">{{notificationCount}}</span>
      
      <!-- Notifications Dropdown -->
      <div class="notifications-dropdown" [class.show]="showNotifications">
        <div class="notifications-header">
          <h4>Notifications</h4>
          <button (click)="markAllAsRead()">Tout marquer comme lu</button>
        </div>
        <div class="notifications-list">
          <div class="notification-item" *ngFor="let notification of notifications" [class.unread]="!notification.read">
            <div class="notification-icon" [ngClass]="notification.type">
              <i [class]="notification.icon"></i>
            </div>
            <div class="notification-content">
              <p class="notification-title">{{notification.title}}</p>
              <p class="notification-message">{{notification.message}}</p>
              <p class="notification-time">{{notification.time}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="profile-container" (click)="toggleProfileDropdown()">
      <div class="profile-avatar">
        <img 
          [src]="userProfile.avatar" 
          [alt]="userProfile.name"
          class="avatar-img"
        >
        <div class="status-indicator" [class.online]="userProfile.isOnline"></div>
      </div>
      
      <div class="profile-dropdown" [class.show]="showProfileDropdown">
        <div class="profile-info">
          <img [src]="userProfile.avatar" [alt]="userProfile.name">
          <div>
            <h4>{{userProfile.name}}</h4>
            <p>{{userProfile.role}}</p>
          </div>
        </div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item" (click)="navigateTo('/profile')">
          <i class="fas fa-user"></i>
          <span>Mon Profil</span>
        </div>
        <div class="dropdown-item" (click)="navigateTo('/settings')">
          <i class="fas fa-cog"></i>
          <span>Paramètres</span>
        </div>
        <div class="dropdown-item" (click)="navigateTo('/help')">
          <i class="fas fa-question-circle"></i>
          <span>Aide & Support</span>
        </div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item logout" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Déconnexion</span>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Sidebar -->
<aside class="sidebar" [class.collapsed]="sidebarCollapsed" [class.dark]="darkMode">
  <nav class="sidebar-nav">
    <div class="nav-group">
      <div class="nav-group-title" *ngIf="!sidebarCollapsed">Principal</div>
      
      <div class="nav-item" 
           [class.active]="activeRoute === 'dashboard'" 
           (click)="navigateTo('/dashboard')">
        <i class="fas fa-chart-bar nav-icon"></i>
        <span class="nav-text">Dashboard</span>
        <div class="nav-indicator"></div>
      </div>
      
      <div class="nav-item" 
           [class.active]="activeRoute === 'map'" 
           (click)="navigateTo('/map')">
        <i class="fas fa-map nav-icon"></i>
        <span class="nav-text">Carte Interactive</span>
        <div class="nav-indicator"></div>
      </div>
    </div>

    <div class="nav-group">
      <div class="nav-group-title" *ngIf="!sidebarCollapsed">Gestion</div>
      
      <div class="nav-item" 
           [class.active]="activeRoute === 'stations'" 
           (click)="navigateTo('/stations')">
        <i class="fas fa-charging-station nav-icon"></i>
        <span class="nav-text">Bornes de Charge</span>
        <span class="nav-badge" *ngIf="stationsCount">{{stationsCount}}</span>
        <div class="nav-indicator"></div>
      </div>
      
      <div class="nav-item" 
     [class.active]="activeRoute === 'user_list'" 
     (click)="navigateTo('/user_list')">
  <i class="fas fa-users nav-icon"></i>
  <span class="nav-text">Utilisateurs</span>
  <span class="nav-badge" *ngIf="usersCount">{{ usersCount }}</span>
  <div class="nav-indicator"></div>
</div>
      
      <div class="nav-item" 
           [class.active]="activeRoute === 'reservations'" 
           (click)="navigateTo('/reservations')">
        <i class="fas fa-calendar-check nav-icon"></i>
        <span class="nav-text">Réservations</span>
        <div class="nav-indicator"></div>
      </div>
    </div>

    <div class="nav-group">
      <div class="nav-group-title" *ngIf="!sidebarCollapsed">Analyses</div>
      
      <div class="nav-item" 
           [class.active]="activeRoute === 'analytics'" 
           (click)="navigateTo('/analytics')">
        <i class="fas fa-chart-line nav-icon"></i>
        <span class="nav-text">Statistiques</span>
        <div class="nav-indicator"></div>
      </div>
      
      <div class="nav-item" 
           [class.active]="activeRoute === 'reports'" 
           (click)="navigateTo('/reports')">
        <i class="fas fa-file-alt nav-icon"></i>
        <span class="nav-text">Rapports</span>
        <div class="nav-indicator"></div>
      </div>
    </div>

    <div class="nav-group">
      <div class="nav-group-title" *ngIf="!sidebarCollapsed">Configuration</div>
      
      <div class="nav-item" 
           [class.active]="activeRoute === 'settings'" 
           (click)="navigateTo('/settings')">
        <i class="fas fa-cog nav-icon"></i>
        <span class="nav-text">Paramètres</span>
        <div class="nav-indicator"></div>
      </div>
    </div>

    <div class="nav-footer">
      <div class="nav-item logout-item" (click)="logout()">
        <i class="fas fa-door-open nav-icon"></i>
        <span class="nav-text">Déconnexion</span>
      </div>
    </div>
  </nav>
</aside>

<!-- Main Content -->
<main class="main-content" [class.expanded]="sidebarCollapsed" [class.dark]="darkMode">
  <div class="page-header">
    <div class="header-left">
      <h1 class="page-title">
        <i class="fas fa-chart-bar"></i>
        Dashboard
      </h1>
      <p class="page-subtitle">Vue d'ensemble de votre réseau ElectroMap</p>
      <div class="breadcrumb">
        <span>Accueil</span>
        <i class="fas fa-chevron-right"></i>
        <span>Dashboard</span>
      </div>
    </div>
    <div class="header-right">
      <div class="date-info">
        <div class="current-date">{{currentDate | date:'EEEE, d MMMM y':'fr'}}</div>
        <div class="current-time">{{currentTime | date:'HH:mm':'fr'}}</div>
      </div>
      <button class="btn-primary" (click)="exportData()">
        <i class="fas fa-download"></i>
        Exporter
      </button>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="quick-stats">
    <div class="stat-item" 
         *ngFor="let stat of quickStats" 
         [class]="stat.type"
         (click)="navigateTo(stat.link)">
      <div class="stat-icon">
        <i [class]="stat.icon"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{stat.value | number}}</div>
        <div class="stat-label">{{stat.label}}</div>
        <div class="stat-change" [class]="stat.trend">
          <i [class]="stat.trend === 'up' ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
          {{stat.change}}%
        </div>
      </div>
      <div class="stat-chart">
        <!-- Mini chart can be added here -->
      </div>
    </div>
  </div>

  <!-- Dashboard Grid -->
  <div class="dashboard-grid">
    <!-- Performance Overview -->
    <div class="dashboard-card performance-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="fas fa-tachometer-alt"></i>
          Performance du Réseau
        </h3>
        <div class="card-actions">
          <button class="btn-icon" (click)="refreshPerformance()">
            <i class="fas fa-sync-alt" [class.spinning]="isRefreshing"></i>
          </button>
        </div>
      </div>
      <div class="card-content">
        <div class="performance-metrics">
          <div class="metric" *ngFor="let metric of performanceMetrics">
            <div class="metric-label">{{metric.label}}</div>
            <div class="metric-value">{{metric.value}}</div>
            <div class="metric-bar">
              <div class="metric-progress" [style.width.%]="metric.percentage" [class]="metric.status"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="dashboard-card activity-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="fas fa-clock"></i>
          Activité Récente
        </h3>
        <button class="btn-text" (click)="navigateTo('/activity')">Voir tout</button>
      </div>
      <div class="card-content">
        <div class="activity-list">
          <div class="activity-item" *ngFor="let activity of recentActivities">
            <div class="activity-icon" [class]="activity.type">
              <i [class]="activity.icon"></i>
            </div>
            <div class="activity-content">
              <p class="activity-title">{{activity.title}}</p>
              <p class="activity-subtitle">{{activity.description}}</p>
              <p class="activity-time">{{activity.timestamp | timeAgo}}</p>
            </div>
            <div class="activity-status" [class]="activity.status">
              <i [class]="getStatusIcon(activity.status)"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Station Status -->
    <div class="dashboard-card stations-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="fas fa-charging-station"></i>
          État des Bornes
        </h3>
        <div class="status-filter">
          <button 
            class="filter-btn" 
            *ngFor="let filter of stationFilters"
            [class.active]="activeStationFilter === filter.key"
            (click)="setStationFilter(filter.key)">
            {{filter.label}}
          </button>
        </div>
      </div>
      <div class="card-content">
        <div class="stations-grid">
          <div class="station-status" *ngFor="let status of stationStatus">
            <div class="status-icon" [class]="status.type">
              <i [class]="status.icon"></i>
            </div>
            <div class="status-info">
              <div class="status-count">{{status.count}}</div>
              <div class="status-label">{{status.label}}</div>
            </div>
            <div class="status-percentage">{{status.percentage}}%</div>
          </div>
        </div>
      </div>
    </div>

    

    <!-- User Growth -->
    <div class="dashboard-card chart-card user-growth">
      <div class="card-header">
        <h3 class="card-title">
          <i class="fas fa-users"></i>
          Croissance Utilisateurs
        </h3>
      </div>
      <div class="card-content">
        <div class="growth-stats">
          <div class="growth-item">
            <div class="growth-number">{{newUsersToday}}</div>
            <div class="growth-label">Nouveaux aujourd'hui</div>
          </div>
          <div class="growth-item">
            <div class="growth-number">{{activeUsersMonth}}</div>
            <div class="growth-label">Actifs ce mois</div>
          </div>
        </div>
        <div class="chart-placeholder">
          <i class="fas fa-chart-line"></i>
          <p>Graphique de croissance</p>
        </div>
      </div>
    </div>

    <!-- Alerts & Issues -->
    <!-- <div class="dashboard-card alerts-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="fas fa-exclamation-triangle"></i>
          Alertes & Problèmes
        </h3>
        <span class="alert-count" *ngIf="alertsCount > 0">{{alertsCount}}</span>
      </div>
      <div class="card-content">
        <div class="alerts-list" *ngIf="alerts.length > 0; else noAlerts">
          <div class="alert-item" *ngFor="let alert of alerts" [class]="alert.severity">
            <div class="alert-icon">
              <i [class]="alert.icon"></i>
            </div>
            <div class="alert-content">
              <p class="alert-title">{{alert.title}}</p>
              <p class="alert-message">{{alert.message}}</p>
              <p class="alert-time">{{alert.timestamp | timeAgo}}</p>
            </div>
            <button class="alert-action" (click)="resolveAlert(alert.id)">
              <i class="fas fa-check"></i>
            </button>
          </div>
        </div>
        <ng-template #noAlerts>
          <div class="no-alerts">
            <i class="fas fa-check-circle"></i>
            <p>Aucune alerte active</p>
          </div>
        </ng-template>
      </div>
    </div> -->
  </div>
</main>

<!-- Loading Overlay -->
<div class="loading-overlay" *ngIf="isLoading">
  <div class="loading-content">
    <div class="spinner"></div>
    <p>Chargement en cours...</p>
  </div>
</div>